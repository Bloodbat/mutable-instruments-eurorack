Mutated-Mutables
================

Various enhancements, experiments and outright hacks of Mutable Instruments firmware code.

This repository is a copy of the Mutable Instruments GitHub repository at https://github.com/pichenettes/eurorack

So far, the only modified code is the Bees-in-Trees enhancements to Braids. The following features (and one anti-feature) have all been implemented in Bees-in-Trees Version 3, the source code for which is in the braids/ directory here. 

Bees-in-Trees v3 enhancements
=============================

* Color is now also a target for the internal envelope (and the new internal LFO – see below). The available choices under the TDST menu are now: SYNC, TIMB, LEVL, T+L, COLR, T+C, L+C, ALL. The compound destinations are self-explanatory. The ability to modulate Color with the internal envelope significantly enhances some of the oscillator models, in others, not so much, and in a few, it is useless, but not harmful.
* Voltage control over the attack and decay of the internal envelope is now possible, via the FM input (and fine tune knob), as in the existing META mode: instead of offering just ON or OFF, the META menu now offers the following choices: OFF , MODL, ATTK, DCAY, AD02, AD05, AD10, AD15, AD20, AD30, AD40, AD50, AD75, A=D, DA90, DA80, DA70, DA60, DA50, DA25 and DA10. MODL is identical to the existing META=ON mode, and causes voltages on the FM input to sweep through the various oscillator models – no change to this. ATTK and DCAY use the voltage on the FM input (plus the fine tune knob setting) to override the attack and decay parameters, respectively, of whatever envelope is currently selected in the TENV menu. In other words, in ATTK mode, the envelope attack time is voltage-controlled via the FM input, but the decay time honours the decay time for whatever fixed envelope type is selected in TENV. Vice-versa for DCAY mode. The remaining new META envelope modes, AD02 through to DA10, put both attack time and decay time of the internal envelope under voltage control via the FM input (and fine tune knob). The numbers refer to the ratio of attack to decay time e.g. for AD20 mode, the ratio of attack time to decay time is 0.2, while for AD75, the ratio is 0.75. By extension, DA60 means the ratio of decay time to attack time is 0.6, which is the same as the ratio of the attack to decay time being 1.66. A=D mode means the attack time equals the decay time. However, although the ratios are fixed for each mode, the actual envelope durations are not – they are under voltage control via the FM input. A voltage range on the FM input of approximately zero to 5 volts will set the envelope segment duration anywhere between its minimum (about 1.5ms) and its maximum (about 12 seconds). Negative voltages are ignored. Note that an external voltage must be supplied to the FM input in order to set the envelope segment duration in these VC envelope modes, but any fixed voltage source can be used, and the duration can then be adjusted via the FM input attenuverter on the Braids module. Alternatively a dynamic external CV source in the 0V to 5V range, such as an external LFO or sequencer, can be used to dynamically vary the envelope segment durations. Note that there is only one envelope segment duration parameter available, via the FM input on Braids, but the ratio of attack to decay times can be adjusted as described above via the META menu using the ADxx or DAxx envelope modes. All existing fixed (non-voltage controlled) envelope types have been retained for use when you wish to use the FM input for some other purpose, such as the original model sweep META mode (MODL), or even, gosh, for its originally intended purpose of frequency modulation.
* Several voltage-controlled internal LFO modes have been added. These are alternatives to the internal envelope – you can’t use both the internal envelope and the internal LFO simultaneously – in fact, the internal LFO is just an automatically re-triggering version of the internal envelope. The LFO modes are also selected via the META menu – the following modes are now available after the new voltage-controlled envelope modes: LFOx, LFO^, LFOw, LFOs, LFO(square), LFO(sawtooth) and LFO(ramp). LFOx uses exponential curves for its equal duration attack and decay times. LFO^ is a triangle wave LFO. LFOs is a sine wave LFO. LFO(square) uses a square-ish waveform. LFO(sawtooth) and LFO(ramp) are sawtooth and ramp waveform LFOs. LFOw is basically a triangle waveform LFO, except that each arm of the triangle is “wiggly” (hence the “w”). This takes advantage of the fact that waveforms produced by wavetable oscillators do not need to be monotonically increasing, so that the LFOw level surges and retreats several times on its rising arm, and drops and then re-swells several times on its falling arm. The LFO frequency is also voltage controlled via the FM input, using the same 0V to 5V range, but the sense is reversed, so that higher voltages increase the frequency, as you would expect. The LFO will run up to low audio frequencies. Like the internal envelope, the internal LFO can modulate Level, Timbre, Color, or any combination of those three. In LFO mode, when Level is selected as the destination, or one of the destinations, the LFO waveform reduces volume from maximum, rather than increases it from minimum as it does in internal envelope mode, thus allowing subtle tremolo effects (see also variable modulation depth, below).
* In the TENV menu, the following new envelope types have been added, after the existing internal envelopes (TT, TIK, WOMP etc): M005, M010, M020, M030…M230, M240, M250 and M255. These new envelope types are intended to be used with the voltage-controlled envelope and LFO modes (see above), and provide gradations of modulation depth (hence the M prefix) from almost none (M005) to full range (M255). These new envelope types allow the Timbre and Color parameters to now be swept over their entire range (using M255) if required, or the modulation depth to be adjusted in fine increments. Note that the modulation depth setting provided by these envelope types has no effect on amplitude (level) when in any of the internal envelope modes (although they do affect Timbre and Color in those modes), but they do affect the depth of level modulation when in any of teh LFO modes, thus allowing depth of tremolo to be set, and depth of Timbre and/or Color modulation as well, of course.

One anti-feature
================
A paschal oophorectomy has been performed: the Easter egg oscillator model has been removed and the ability to trigger Easter egg mode has been disabled. One could say that the code for it has been Pynchoned off… This was necessary to free up space for the enhancements described above. Sorry!

Non-features
============
The following enhancements have not been ported to Bees-in-Trees v3, either because they are now superseded by enhancements in Braids v1.7 code on which Bees-in-Tree v3 is based, or they won't fit (WTx2 mode)

* WTx2 duophonic wavetable model with second voice offset controlled by the Color parameter: this new model is the love-child of the existing triple waveform models and the existing WTx4 model. Unlike the WTx4 model, it has only two paraphonic “voices”, not four, and the pitch of the second voice is offset from the first voice by an amount set by the Color parameter (both Color potentiometer and Color CV input), in the same way that the Color parameter controls the third voice in the triple oscillator models. Timbre scans the same wavetable in the same manner as it does in the WTx4 model. However, each of the two “voices” consists of two wavetable oscillator instances, each detuned from each other by a small amount. The degree of detune is different for each pair of oscillators, and also varies as the Color parameter changes. The result is a thick chorus effect on both “voices”, an effect which varies as the Color parameter is swept. Caveat: both external and internal (auto) triggers may causee an audible click in this model if no amplitude (level) envelope (either internal or external via a separate VCA and envelope generator) is used. This is because a trigger causes the phase of all four wavetables to be reset to random positions, resulting in extra lushness. This issue also affects the existing WTx4 model in the official Braids firmware, particularly if all four wavetables are in unison or almost so. The solution is to use an amplitude envelope in order to make the initial click inaudible, or to not send any external triggers or use internal auto triggers when the WTx2 model is used.
* Square-sawtooth-triangle triple oscillator model: this works identically to the existing triple sawtooth and triple square oscillator models, except that instead of sawtooth or square waveforms for each paraphonic voice, it uses one square, one sawtooth and one triangle waveform. The result is appreciably different from the existing triple waveform models. (Note: this will be dropped from Bees-in-Trees v3 because it is not sufficiently different from the existing triple square wave model in Braids IMHO).
* Triple triangle oscillator model (^^x3): this works identically to the existing triple sawtooth and triple square oscillator models, except that it uses a triangle waveform for all three oscillators. Due to the much less bright harmonics in a triangle wave, it can be used effectively without any filtering, if desired. (Note: this has been superseded by the triple triangle model now present in Braids v1.7, which will also be in Bees-in-Trees v3 of course).
* Triple sine wave oscillator model (SINS): this works identically to the existing triple sawtooth and triple square oscillator models, except that it uses a sine waveform for all three oscillators. Due to the absent harmonics in a sine wave, it can be used effectively without any filtering, if desired, although there are some harmonics because all three waves are summed – nonetheless, it sounds very smooth and rounded, sans filtering, as you might expect. (Note: this has been superseded by the triple sine wave model now present in Braids v1.7, which will also be in Bees-in-Trees v3 of course).

Discussion
==========
All these enhancements seem to work fine, but more extensive testing is required. They are intended for advanced users only, and assume thorough familiarity with the way Braids operates. The additions to the TDST, TENV and META submenus can all interact with each other, by design, to substantially extend the range of sounds that can be coaxed out of a Braids, without using any other modules (except a fixed voltage source). As such, Bees-in-Trees may be particularly useful in small systems where external modulation sources are few, but since it does not remove or subtract any existing Braids features or capabilities apart from the Easter egg, it may be useful even in large systems.

Control of the new capabilities has been provided at this stage by “overloading” (some would say thoroughly abusing) the existing menu structure. This has been done out of expedience. However, if Bees-in-Trees proves to be valuable, then the enhancements described above, and others, can be controlled far more elegantly by implementing a restructured and extended Braids menu system – that seems quite feasible. For example, a separate menu could be provided to set the modulation depth. Other enhancements might be possible, depending on storage space available. For example: separate modulation depths for each of Level, Timbre and Color; the ability to reverse the modulation sweep independently on Timbre or Color (so Color goes up when Timbre goes down and v-v); or provide FM as a target when in LFO mode (i.e. provide built-in vibrato, possibly with selectable delayed onset times…).

